<!-- <p align="center">
<img src="https://i.kym-cdn.com/photos/images/original/001/545/361/502.jpg" width="200" height="200" alt="In this repo we use neither 'therefore' nor 'furthermore'"/>
</p>
<p align="center">
In this repo we use neither 'therefore' nor 'furthermore'
</p>

# Reliable lower bound for QKD key rate
This repo contains Python and Fortran 90 code to perform a reliable lower bound for QKD key rate using convex optimization.

## Requirements
<p align="center"><img src="https://img.shields.io/badge/python-3.8.7-green" /><img src="https://img.shields.io/badge/cvxpy-1.1.15-green" /><img src="https://img.shields.io/badge/scipy-1.7.1-green" /><img src="https://img.shields.io/badge/numpy-1.23.0-green" /><img src="https://img.shields.io/badge/matplotlib-3.4.3-green" /><br /><img src="https://img.shields.io/badge/fortran-90-purple" /><img src="https://img.shields.io/badge/gcc-9.2.0-purple" /><img src="https://img.shields.io/badge/lapack-3.9.0-purple" /><img src="https://img.shields.io/badge/blas-3.1.0-purple" /><img src="https://img.shields.io/badge/SDPA-7.3.9-purple" /></p> -->

<p align="center">
<img src="https://i.kym-cdn.com/photos/images/original/001/545/361/502.jpg" width="250" height="250" alt="In this repo we use neither 'therefore' nor 'furthermore'"/>
</p>
<p align="center">
In this repo we use neither 'therefore' nor 'furthermore'
</p>
<h1  align="center" >Reliable lower bound for QKD key rate</h2>
<p align="center">
Python and Fortran 90 code to perform a reliable lower bound for QKD key rate using convex optimization.
</p>

<h2  align="center" >Requirements</h2>
<p align="center">
  <br/>
  <img src="https://img.shields.io/badge/python-3.8.7-green" />
  <img src="https://img.shields.io/badge/cvxpy-1.1.15-green" />
  <img src="https://img.shields.io/badge/scipy-1.7.1-green" />
  <img src="https://img.shields.io/badge/numpy-1.23.0-green" />
  <img src="https://img.shields.io/badge/matplotlib-3.4.3-green" />
  <br />
  <img src="https://img.shields.io/badge/fortran-90-purple" />
  <img src="https://img.shields.io/badge/gcc-9.2.0-purple" />
  <img src="https://img.shields.io/badge/gnuplot-5.4-purple" />
  <img src="https://img.shields.io/badge/lapack-3.9.0-purple" />
  <img src="https://img.shields.io/badge/blas-3.1.0-purple" />
  <img src="https://img.shields.io/badge/SDPA-7.3.9-purple" />
</p>

## Installation
Clone this repo<!--  [repo](https://github.com/sebastiano123-c/simulazione) -->
```bash
git clone git@github.com:sebastiano123-c/Reliable-lower-bound-simulation.git
```

## Theory
Theory is briefly explained in the [documentation](https://github.com/sebastiano123-c/simulazione/blob/master/main.pdf).<br/>
More references:
 - https://doi.org/10.22331/q-2018-07-26-77
 - https://doi.org/10.1103/PhysRevResearch.3.013274


## Python Usage
Require 'MOSEK' solver (under license,  you can find it [here](https://www.mosek.com/products/academic-licenses/)). <br/>
It is ok to use 'CVXOPT' instead, but it crashes quite often.

```python
"""
simple EB BB84 protocol

@author: Sebastiano Cocchi
"""
from src import qkd
import numpy as np

# create simulation
sim = qkd.QKD(dim_a=2, dim_b=2, n_of_signal_states=4,
list_of_states_a=[qkd.zero, qkd.one, qkd.plus, qkd.minus], list_of_prob_a=[0.25, 0.25, 0.25, 0.25],
list_of_states_b=[qkd.zero, qkd.one, qkd.plus, qkd.minus], list_of_prob_b=[0.25, 0.25, 0.25, 0.25])

# define QBER interval
qber = [0, 0.02, 0.04, 0.6, 0.08, 0.1, 0.12]

# define result list
key_primal = []
key_dual   = [] 

for ii in qber:
    # calculate EC leak
    hp = qkd.binary_entropy(ii)

    # apply quantum channel
    sim.apply_quantum_channel(qkd.depolarizing_channel(2*ii))

    # calculate contraints
    gamma = []
    for jj in sim.povm:
        gamma.append(np.trace(jj @ sim.rho_ab))
    
    # set contraints
    sim.set_constraints(gamma, sim.povm)

    # compute primal and dual problem
    sim.compute_primal()
    sim.compute_dual()

    key_primal.append(sim.primal_sol - hp)
    key_dual.append(sim.primal_sol - hp)  
```

## Fortran 90 usage
Compile 
```bash
gfortran main.f90 -o main.exe -Ofast -L'path-to-lapack-3.9.0/build/bin' -llapack -lblas
```
main.f90 and simple_BB84.f90 requires the modules (in 'src' directory):
 - debugging.f90, where are defined checkpoints and print functions;
 - matrices.f90, useful for matrices calculations (over all the tedious logarithm of a matrix)
 - QKD.f90, containing functions and subroutines for entropy and SDP solving.
```fortran
include "src/debugging.f90"
include "src/matrices.f90"
include "src/QKD.f90"
```
I have used SDPA solver (download [here](https://sdpa.sourceforge.net/download.html)), which is an executable file SDPA.exe which requires an input *.dat file and writes the solution onto a *.out file.
SDPA.exe must be in the same folder of the executables.
For Fortran files, plots are generated by [gnuplot](https://www.gnuplot.info/download.html).

Still, Fortran 90 program has problems with the SDP solution, I'll try to fix them.