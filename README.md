![In this repo we don't neither 'therefore' nor 'furthermore'](analysis/cane.jfif)

# Simulation: reliable lower bound for QKD protocols key rates
This repo contains Python and Fortran 90 code to perform a reliable lower bound for QKD key rate using convex optimization.
In particular the minimization is a semidefinite program (SDP)
```latex
Primal problem is defined as
minimize   : \langle C,X\rangle_{S^n}
subject to : \langle A_i,X\rangle_{S^n}=b_i, \quad i=1,\ldots,m
            X\succeq 0
whose dual is 
maximize   : \sum_i b_i y_i 
subject to : \sum_i A_i y_i \preceq C.
```
Theory is briefly written in main.pdf.
More information here:
 - https://doi.org/10.22331/q-2018-07-26-77
 - https://doi.org/10.1103/PhysRevResearch.3.013274
The convex optimization, SDP solver, I recommend using 'MOSEK' solver (it requires a license you can find [here](https://www.mosek.com/products/academic-licenses/)).
It is ok to use 'CVXOPT' instead, but it crashes quite often.

## Installation

Clone this [repo](https://github.com/sebastiano123-c/simulazione).

## Python Usage
```python
"""
simple EB BB84 protocol

@author: Sebastiano Cocchi
"""
from src import qkd

# create simulation
sim = qkd.QKD(dim_a=2, dim_b=2, n_of_signal_states=4,
list_of_states_a=[qkd.zero, qkd.one, qkd.plus, qkd.minus], list_of_prob_a=[0.25, 0.25, 0.25, 0.25],
list_of_states_b=[qkd.zero, qkd.one, qkd.plus, qkd.minus], list_of_prob_b=[0.25, 0.25, 0.25, 0.25])

# define QBER interval
qber = [0, 0.02, 0.04, 0.6, 0.08, 0.1, 0.12]

# define result list
key_primal = []
key_dual   = [] 

for ii in qber:
    # calculate EC leak
    hp = qkd.binary_entropy(ii)

    # apply quantum channel
    sim.apply_quantum_channel(qkd.depolarizing_channel(2*ii))

    # calculate contraints
    gamma = []
    for jj in sim.povm:
        gamma.append(np.trace(jj @ sim.rho_ab))
    
    # set contraints
    sim.set_constraints(gamma, sim.povm)

    # compute primal and dual problem
    sim.compute_primal()
    sim.compute_dual()

    key_primal.append(sim.primal_sol - hp)
    key_dual.append(sim.primal_sol - hp)  
```

## Fortran 90
The simulation is also made in Fortran 90. 
The files are main.f90 and simple_BB84.f90 which requires the modules (in 'src' directory):
 - debugging.f90, where are defined checkpoints and print functions;
 - matrices.f90, useful for matrices calculations (over all the tedious logarithm of a matrix)
 - QKD.f90, containing functions and subroutines calculating entropies and SPDA.
I have used SDPA solver (download [here](https://sdpa.sourceforge.net/download.html)), which is an executable file SPDA.exe which requires an input *.dat file and writes the solution onto a *.out file.
SDPA.exe must be in the same folder of the executables.
For Fortran files, plots are generated by [gnuplot](https://www.gnuplot.info/download.html).

Still, Fortran 90 program has problems with the SDP solution, I'll try to fix them.